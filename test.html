<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>2D Space Simulation</title>
  <style>
    body { margin: 0; padding: 20px; font-family: Arial; text-align: center; }
    canvas { display: block; margin: 20px auto; border: 1px solid #ccc; }
    #controls {
      display: inline-block;
      margin-top: 10px;
      padding: 10px;
      border: 1px solid #ccc;
      background-color: #f0f0f0;
      text-align: left;
    }
    label { display: inline-block; width: 160px; margin-bottom: 5px; }
    input[type="range"] { width: 150px; vertical-align: middle; }
    .value-display { display: inline-block; width: 40px; text-align: right; margin-left: 5px; }
    button { padding: 5px 15px; font-size: 14px; margin-top: 10px; }
  </style>
  <script async src="https://unpkg.com/es-module-shims@1.8.0/dist/es-module-shims.js"></script>
  <script type="importmap">
  {
    "imports": {
      "p5": "https://cdn.jsdelivr.net/npm/p5@1.9.0/+esm"
    }
  }
  </script>
</head>
<body>
  <h2>2D Space Simulation</h2>
  <div id="canvas-container"></div>
  <div id="controls">
    <label for="velocity">Launch Velocity:</label>
    <input type="range" id="velocity" min="0" max="10" step="0.1" value="2">
    <span id="velocity-value" class="value-display">2</span>
    <br>
    <label for="angle">Launch Angle (degrees):</label>
    <input type="range" id="angle" min="0" max="90" step="1" value="45">
    <span id="angle-value" class="value-display">45</span>
    <br>
    <button id="launch">Launch</button>
    <button id="reset">Reset</button>
  </div>

  <script type="module">
    import p5 from 'p5';

    const sketch = (p) => {
      let earthRadius = 100;
      let earthCenterX, earthCenterY;
      let ship;
      let trail = [];
      let launched = false;
      let G = 1;
      let M = 10000;
      let dt = 0.5;

      class Spacecraft {
        constructor(x, y, vx, vy) {
          this.x = x;
          this.y = y;
          this.vx = vx;
          this.vy = vy;
          this.radius = 5;
          this.history = [];
        }

        update() {
          let dx = earthCenterX - this.x;
          let dy = earthCenterY - this.y;
          let dist = Math.sqrt(dx * dx + dy * dy);
          if (dist < earthRadius + this.radius) dist = earthRadius + this.radius;
          let force = (G * M) / (dist * dist);
          let angle = Math.atan2(dy, dx);
          let ax = force * Math.cos(angle);
          let ay = force * Math.sin(angle);
          this.vx += ax * dt;
          this.vy += ay * dt;
          this.x += this.vx * dt;
          this.y += this.vy * dt;
          this.history.push({ x: this.x, y: this.y });
          if (this.history.length > 1000) this.history.shift();
          return dist <= earthRadius + this.radius;
        }

        show() {
          p.noStroke();
          p.fill(255, 0, 0);
          p.ellipse(this.x, this.y, this.radius * 2);
        }
      }

      p.setup = () => {
        let canvas = p.createCanvas(600, 600);
        canvas.parent('canvas-container');
        earthCenterX = p.width / 2;
        earthCenterY = p.height / 2;
        ship = new Spacecraft(earthCenterX, earthCenterY + earthRadius, 0, 0);
        document.getElementById('launch').addEventListener('click', () => {
          if (!launched) {
            let velocity = parseFloat(document.getElementById('velocity').value);
            let angle = parseFloat(document.getElementById('angle').value) * Math.PI / 180;
            ship.vx = velocity * Math.cos(angle);
            ship.vy = -velocity * Math.sin(angle);
            launched = true;
            trail = [];
          }
        });
        document.getElementById('reset').addEventListener('click', () => {
          ship = new Spacecraft(earthCenterX, earthCenterY + earthRadius, 0, 0);
          launched = false;
          trail = [];
        });
        document.getElementById('velocity').addEventListener('input', (e) => {
          document.getElementById('velocity-value').textContent = e.target.value;
        });
        document.getElementById('angle').addEventListener('input', (e) => {
          document.getElementById('angle-value').textContent = e.target.value;
        });
      };

      p.draw = () => {
        p.background(0);
        p.fill(0, 0, 255);
        p.noStroke();
        p.ellipse(earthCenterX, earthCenterY, earthRadius * 2);
        if (launched) {
          let collision = ship.update();
          ship.show();
          p.stroke(255);
          p.noFill();
          p.beginShape();
          ship.history.forEach(pt => p.vertex(pt.x, pt.y));
          p.endShape();
          if (collision) {
            p.noLoop();
            alert("Spacecraft crashed!");
          }
        } else {
          ship.show();
        }
      };
    };

    new p5(sketch);
  </script>
</body>
</html>