<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Harmonograph Simulation</title>
    <script type="importmap">
        {
          "imports": {
            "p5": "https://cdn.jsdelivr.net/npm/p5@1.11.3/lib/p5.min.js"
          }
        }
    </script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .controls {
            background-color: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            width: 600px;
            box-sizing: border-box;
        }
        .control-group {
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="range"] {
            width: 70%;
        }
        .value-display {
            display: inline-block;
            width: 40px;
            text-align: right;
            margin-left: 10px;
        }
        button {
            padding: 8px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        canvas {
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <h1>Harmonograph Simulation</h1>
    <div class="controls">
        <div class="control-group">
            <label for="freq1">Frequency 1:</label>
            <input type="range" id="freq1" min="1" max="10" value="3" step="0.1">
            <span id="freq1-value" class="value-display">3.0</span>
        </div>
        <div class="control-group">
            <label for="freq2">Frequency 2:</label>
            <input type="range" id="freq2" min="1" max="10" value="2" step="0.1">
            <span id="freq2-value" class="value-display">2.0</span>
        </div>
        <div class="control-group">
            <label for="amp1">Amplitude 1:</label>
            <input type="range" id="amp1" min="10" max="200" value="150" step="1">
            <span id="amp1-value" class="value-display">150</span>
        </div>
        <div class="control-group">
            <label for="amp2">Amplitude 2:</label>
            <input type="range" id="amp2" min="10" max="200" value="100" step="1">
            <span id="amp2-value" class="value-display">100</span>
        </div>
        <div class="control-group">
            <label for="phase1">Phase 1:</label>
            <input type="range" id="phase1" min="0" max="360" value="0" step="1">
            <span id="phase1-value" class="value-display">0</span>
        </div>
        <div class="control-group">
            <label for="phase2">Phase 2:</label>
            <input type="range" id="phase2" min="0" max="360" value="90" step="1">
            <span id="phase2-value" class="value-display">90</span>
        </div>
        <div class="control-group">
            <label for="damp1">Damping 1:</label>
            <input type="range" id="damp1" min="0" max="0.1" value="0.01" step="0.001">
            <span id="damp1-value" class="value-display">0.01</span>
        </div>
        <div class="control-group">
            <label for="damp2">Damping 2:</label>
            <input type="range" id="damp2" min="0" max="0.1" value="0.02" step="0.001">
            <span id="damp2-value" class="value-display">0.02</span>
        </div>
        <button id="clear-button">Clear Drawing</button>
    </div>

    <div id="sketch-holder"></div>

    <script type="module">
        import 'p5';

        /**
         * @param {p5} p - The p5.js instance.
         */
        let sketch = function(p) {
            // Parameters for the first pendulum
            let freq1 = 3;    // Frequency of oscillation (lower = slower)
            let amp1 = 150;   // Amplitude of swing (larger = wider arc)
            let phase1 = 0;   // Phase offset (changes starting position)
            let damp1 = 0.01;  // Damping factor (higher = faster slow-down)

            // Parameters for the second pendulum
            let freq2 = 2;    // Frequency of oscillation
            let amp2 = 100;   // Amplitude of swing
            let phase2 = 90;  // Phase offset
            let damp2 = 0.02;  // Damping factor

            let decayFactor = 0.995; // Controls how quickly the path fades
            let trail = [];          // Array to store previous positions
            let maxTrailLength = 500;// Maximum number of points in the trail

            /**
             * Setup function to initialize the canvas and event listeners.
             */
            p.setup = function() {
                let canvas = p.createCanvas(600, 600);
                canvas.parent('sketch-holder');

                // Set up all the slider event listeners
                document.getElementById('freq1').addEventListener('input', function() {
                    freq1 = parseFloat(this.value);
                    document.getElementById('freq1-value').textContent = freq1.toFixed(1);
                    resetSimulation();
                });

                document.getElementById('freq2').addEventListener('input', function() {
                    freq2 = parseFloat(this.value);
                    document.getElementById('freq2-value').textContent = freq2.toFixed(1);
                    resetSimulation();
                });

                document.getElementById('amp1').addEventListener('input', function() {
                    amp1 = parseFloat(this.value);
                    document.getElementById('amp1-value').textContent = amp1;
                    resetSimulation();
                });

                document.getElementById('amp2').addEventListener('input', function() {
                    amp2 = parseFloat(this.value);
                    document.getElementById('amp2-value').textContent = amp2;
                    resetSimulation();
                });

                document.getElementById('phase1').addEventListener('input', function() {
                    phase1 = parseFloat(this.value);
                    document.getElementById('phase1-value').textContent = phase1;
                    resetSimulation();
                });

                document.getElementById('phase2').addEventListener('input', function() {
                    phase2 = parseFloat(this.value);
                    document.getElementById('phase2-value').textContent = phase2;
                    resetSimulation();
                });

                document.getElementById('damp1').addEventListener('input', function() {
                    damp1 = parseFloat(this.value);
                    document.getElementById('damp1-value').textContent = damp1.toFixed(3);
                    resetSimulation();
                });

                document.getElementById('damp2').addEventListener('input', function() {
                    damp2 = parseFloat(this.value);
                    document.getElementById('damp2-value').textContent = damp2.toFixed(3);
                    resetSimulation();
                });

                // Set up clear button
                document.getElementById('clear-button').addEventListener('click', function() {
                    resetSimulation();
                });

                p.background(0);
            };

            /**
             * Draw function called on each frame.
             */
            p.draw = function() {
                // Calculate pendulum angles using sine waves with damping
                let angle1 = p.sin(p.frameCount * freq1 * 0.01 + p.radians(phase1)) * amp1 * p.pow(1 - damp1, p.frameCount);
                let angle2 = p.sin(p.frameCount * freq2 * 0.01 + p.radians(phase2)) * amp2 * p.pow(1 - damp2, p.frameCount);

                // Calculate pendulum positions
                let pendulumX = angle1;
                let pendulumY = angle2;

                // Store current position in trail
                trail.push({x: pendulumX, y: pendulumY, alpha: 255});

                // Calculate how long the trail should be based on damping
                let effectiveTrailLength = p.max(50, maxTrailLength * (damp1 + damp2) * 5);

                // Remove oldest points if trail is too long
                if (trail.length > effectiveTrailLength) {
                    trail.shift();
                }

                // Draw the background with a very low alpha to create fading effect
                p.background(0, 0, 0, 10);

                // Draw the trail
                p.translate(p.width/2, p.height/2);
                p.noFill();

                // Draw connecting lines
                for (let i = 1; i < trail.length; i++) {
                    let current = trail[i];
                    let previous = trail[i-1];

                    // Calculate alpha based on position in trail (newer points = more opaque)
                    let alphaValue = current.alpha * (i / trail.length);

                    // Draw line segment with color based on position
                    let hue = (i / trail.length) * 255;
                    p.stroke(hue, 255, 255, alphaValue);
                    p.strokeWeight(2);
                    p.line(previous.x, previous.y, current.x, current.y);
                }

                // Draw points
                for (let i = 0; i < trail.length; i++) {
                    let point = trail[i];
                    let alphaValue = point.alpha * (i / trail.length);
                    let hue = (i / trail.length) * 255;
                    p.stroke(hue, 255, 255, alphaValue);
                    p.strokeWeight(4);
                    p.point(point.x, point.y);
                }
            };

            /**
             * Reset the simulation by clearing the trail and background.
             */
            function resetSimulation() {
                trail = [];
                p.background(0);
            }
        };

        // Create a new p5 instance with the sketch
        new window.p5(sketch);
    </script>
</body>
</html>