<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elevator Physics Simulation</title>
    <script async src="https://unpkg.com/es-module-shims@1.8.0/dist/es-module-shims.js"></script>
    <script type="importmap">
    {
        "imports": {
            "p5": "https://cdn.jsdelivr.net/npm/p5@1.9.0/+esm"
        }
    }
    </script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f0f0;
        }
        #simulation-container {
            border: 1px solid #ccc;
            margin-bottom: 15px;
            background-color: white;
        }
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
        }
        button {
            padding: 8px 16px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            color: white;
            font-weight: bold;
        }
        #start-btn {
            background-color: #4CAF50;
        }
        #stop-btn {
            background-color: #f44336;
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .info {
            font-size: 14px;
            color: #333;
        }
    </style>
</head>
<body>
    <h1>Elevator Physics Simulation</h1>
    <div class="info">Click Start to begin the elevator descent</div>
    <div class="controls">
        <button id="start-btn">Start</button>
        <button id="stop-btn" disabled>EMERGENCY STOP</button>
    </div>
    <div id="simulation-container"></div>
    <script type="module">
        import p5 from "p5";

        /**
         * Initializes the elevator physics simulation.
         * 
         * This simulation models an elevator descending with a counterweight system.
         * It demonstrates the effects of inertia and momentum when the elevator is
         * stopped suddenly, causing the counterweight to stretch the cable.
         * 
         * @param {number} width - The width of the simulation canvas
         * @param {number} height - The height of the simulation canvas
         */
        function elevatorPhysics(width, height) {
            let elevatorY = 0;
            let counterweightY = height;
            let isDescending = false;
            let isStopped = false;
            let cableStretch = 0;
            let cableStress = 0;
            let stretchVelocity = 0;
            let massRatio = 1.5; // Ratio of counterweight mass to elevator mass

            const sketch = (p) => {
                p.setup = () => {
                    const canvas = p.createCanvas(width, height);
                    canvas.parent('simulation-container');

                    document.getElementById('start-btn').addEventListener('click', () => {
                        isDescending = true;
                        isStopped = false;
                        cableStretch = 0;
                        cableStress = 0;
                        document.getElementById('start-btn').disabled = true;
                        document.getElementById('stop-btn').disabled = false;
                    });

                    document.getElementById('stop-btn').addEventListener('click', () => {
                        isStopped = true;
                        document.getElementById('stop-btn').disabled = true;
                    });
                };

                p.draw = () => {
                    p.background(240);
                    drawShafts(p);
                    drawPulley(p, 200, 20, 30);
                    drawPulley(p, 400, 20, 30);
                    drawCable(p);
                    drawElevator(p);
                    drawCounterweight(p);
                    updatePhysics(p);
                };

                /**
                 * Draws the vertical shafts for the elevator and counterweight
                 * 
                 * @param {object} p - The p5.js instance
                 */
                function drawShafts(p) {
                    p.fill(200);
                    p.rect(150, 0, 100, height);
                    p.rect(350, 0, 100, height);
                }

                /**
                 * Draws a pulley at the specified position
                 * 
                 * @param {object} p - The p5.js instance
                 * @param {number} x - The x-coordinate of the pulley center
                 * @param {number} y - The y-coordinate of the pulley center
                 * @param {number} size - The diameter of the pulley
                 */
                function drawPulley(p, x, y, size) {
                    p.fill(150);
                    p.stroke(100);
                    p.strokeWeight(2);
                    p.ellipse(x, y, size, size);
                }

                /**
                 * Draws the cable connecting the elevator and counterweight
                 * 
                 * @param {object} p - The p5.js instance
                 */
                function drawCable(p) {
                    const startX = 200;
                    const endX = 400;
                    const baseY = 50;

                    // Left side of cable
                    p.stroke(50);
                    p.strokeWeight(3);
                    p.line(startX, baseY, startX, elevatorY);

                    // Right side of cable
                    p.line(endX, baseY, endX, counterweightY + cableStretch);

                    // Calculate cable stress visualization
                    const stressMultiplier = cableStress * 0.3;
                    const startStretchX = p.lerp(startX, endX, 0.4);
                    const endStretchX = p.lerp(startX, endX, 0.6);

                    // Top cable with stress-induced bend
                    p.beginShape();
                    p.vertex(startX, baseY);
                    p.bezierVertex(
                        startStretchX, baseY + stressMultiplier * 10,
                        endStretchX, baseY + stressMultiplier * 15,
                        endX, baseY
                    );
                    p.endShape();
                }

                /**
                 * Draws the elevator car in its shaft
                 * 
                 * @param {object} p - The p5.js instance
                 */
                function drawElevator(p) {
                    p.fill(100, 150, 200);
                    p.stroke(50);
                    p.strokeWeight(1);
                    p.rect(170, elevatorY, 60, 40);
                }

                /**
                 * Draws the counterweight in its shaft
                 * 
                 * @param {object} p - The p5.js instance
                 */
                function drawCounterweight(p) {
                    p.fill(200, 100, 100);
                    p.stroke(50);
                    p.strokeWeight(1);
                    p.rect(370, counterweightY, 60, 40 + cableStretch);
                }

                /**
                 * Updates the physics of the elevator system
                 * 
                 * Handles the motion of the elevator and counterweight, applies
                 * inertia when the system is stopped, and calculates cable stress
                 * 
                 * @param {object} p - The p5.js instance
                 */
                function updatePhysics(p) {
                    if (isDescending) {
                        if (!isStopped) {
                            // Normal descent physics
                            const acceleration = 0.5;
                            elevatorY += acceleration;
                            counterweightY -= acceleration;

                            if (elevatorY >= height - 40) {
                                isDescending = false;
                                document.getElementById('start-btn').disabled = false;
                            }
                        } else {
                            // Emergency stop physics with inertia
                            const springConstant = 0.1;
                            const damping = 0.92;

                            // Apply spring force based on cable stretch
                            const springForce = -springConstant * cableStretch;
                            stretchVelocity += springForce;

                            // Update stretch with damping
                            stretchVelocity *= damping;
                            cableStretch += stretchVelocity;

                            // Calculate cable stress based on stretch
                            cableStress = p.abs(cableStretch) * massRatio;

                            if (cableStretch < 0.1) {
                                cableStretch = 0;
                                cableStress = 0;
                                stretchVelocity = 0;
                            }
                        }
                    }
                }
            };

            new p5(sketch);
        }

        elevatorPhysics(600, 400);
    </script>
</body>
</html>
