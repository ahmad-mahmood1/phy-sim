<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>2D Baseball Physics Simulation</title>
  <style>
    body { margin: 0; padding: 20px; font-family: Arial, sans-serif; display: flex; flex-direction: column; align-items: center; }
    .controls { margin-bottom: 10px; display: flex; flex-wrap: wrap; gap: 15px; align-items: center; justify-content: center; }
    .control-group { display: flex; flex-direction: column; align-items: center; }
    label { margin-bottom: 5px; font-size: 14px; }
    button { padding: 8px 16px; font-size: 16px; cursor: pointer; border: none; border-radius: 4px; background-color: #4CAF50; color: white; }
    button:disabled { background-color: #cccccc; cursor: not-allowed; }
  </style>
  <script async src="https://unpkg.com/es-module-shims@1.8.0/dist/es-module-shims.js"></script>
  <script type="importmap">
    {
      "imports": {
        "p5": "https://cdn.jsdelivr.net/npm/p5@1.9.0/+esm"
      }
    }
  </script>
</head>
<body>
  <h1>2D Baseball Physics Simulation</h1>

  <div class="controls">
    <div class="control-group">
      <label for="velocity">Launch Velocity (m/s)</label>
      <input type="range" id="velocity" min="10" max="50" value="30">
      <span id="velocity-value">30</span>
    </div>

    <div class="control-group">
      <label for="angle">Launch Angle (°)</label>
      <input type="range" id="angle" min="0" max="90" value="45">
      <span id="angle-value">45</span>
    </div>

    <div class="control-group">
      <label for="wind">Wind Speed (m/s)</label>
      <input type="range" id="wind" min="-10" max="10" value="0">
      <span id="wind-value">0</span>
    </div>

    <div class="control-group">
      <label for="catcher-height">Catcher Height</label>
      <input type="range" id="catcher-height" min="0" max="100" value="50">
      <span id="catcher-height-value">50</span>
    </div>

    <button id="launch">Launch Ball</button>
    <button id="reset">Reset</button>
  </div>

  <div id="simulation-container"></div>
  <div id="result"></div>
  <div id="max-height"></div>

  <script type="module">
    import p5 from "p5";

    const sketch = (p) => {
      // Physics constants
      const gravity = 9.81; // m/s²
      const airDensity = 1.225; // kg/m³
      const ballMass = 0.145; // kg (baseball mass)
      const ballDiameter = 0.074; // m (baseball diameter)
      const dragCoefficient = 0.47; // sphere drag coefficient
      const scale = 5; // pixels per meter

      // Game state
      let ball = null;
      let launched = false;
      let caught = false;
      let hitGround = false;
      let maxHeight = 0;
      let catcherY = 50;

      // Controls
      let velocity = 30;
      let angle = 45;
      let windSpeed = 0;

      // UI elements
      let velocitySlider, angleSlider, windSlider, catcherHeightSlider;
      let launchButton, resetButton;
      let resultDiv, maxHeightDiv;

      p.setup = () => {
        const canvas = p.createCanvas(800, 400);
        canvas.parent('simulation-container');

        // Initialize UI elements
        velocitySlider = document.getElementById('velocity');
        angleSlider = document.getElementById('angle');
        windSlider = document.getElementById('wind');
        catcherHeightSlider = document.getElementById('catcher-height');
        launchButton = document.getElementById('launch');
        resetButton = document.getElementById('reset');
        resultDiv = document.getElementById('result');
        maxHeightDiv = document.getElementById('max-height');

        // Add event listeners
        velocitySlider.addEventListener('input', updateVelocity);
        angleSlider.addEventListener('input', updateAngle);
        windSlider.addEventListener('input', updateWind);
        catcherHeightSlider.addEventListener('input', updateCatcherHeight);
        launchButton.addEventListener('click', launchBall);
        resetButton.addEventListener('click', resetSimulation);

        // Initialize UI values
        updateVelocity();
        updateAngle();
        updateWind();
        updateCatcherHeight();
      };

      p.draw = () => {
        p.background(240);

        // Draw field
        p.fill(100, 200, 100);
        p.noStroke();
        p.rect(0, p.height - 50, p.width, 50);

        // Draw batter
        p.fill(200, 100, 50);
        p.rect(50, p.height - 100, 20, 50);

        // Draw catcher
        const catcherX = p.width - 100;
        const catcherHeadY = p.height - 100 - catcherY;
        const catcherBodyHeight = 100;
        const catcherBodyY = catcherHeadY + 20;
        const catcherLegHeight = 50;

        // Catcher head
        p.fill(50, 100, 200);
        p.ellipse(catcherX, catcherHeadY, 20, 20);

        // Catcher body
        p.fill(200, 50, 50);
        p.rect(catcherX - 10, catcherBodyY, 20, catcherBodyHeight);

        // Catcher legs
        p.fill(50, 50, 200);
        p.rect(catcherX - 10, catcherBodyY + catcherBodyHeight, 20, catcherLegHeight);

        // Update and draw ball
        if (launched && ball) {
          ball.update();
          ball.show();

          // Check for collisions
          checkCollisions(catcherX, catcherHeadY, catcherBodyY, catcherBodyHeight, catcherLegHeight);

          // Update max height
          if (ball.pos.y < maxHeight) {
            maxHeight = ball.pos.y;
            maxHeightDiv.textContent = `Max Height: ${((p.height - maxHeight) / scale).toFixed(2)} m`;
          }
        }
      };

      class Ball {
        constructor(x, y, vx, vy) {
          this.pos = p.createVector(x, y);
          this.vel = p.createVector(vx, vy);
          this.radius = 10;
        }

        update() {
          // Apply gravity
          this.vel.y += gravity / 60;

          // Apply air resistance (drag)
          const speed = this.vel.mag();
          const dragForce = p5.Vector.mult(this.vel, -0.5 * airDensity * dragCoefficient * Math.PI * (ballDiameter / 2) ** 2 * speed / ballMass);
          this.vel.add(dragForce);

          // Apply wind
          this.vel.x += windSpeed / 60;

          // Update position
          this.pos.add(p5.Vector.mult(this.vel, 1 / 60));
        }

        show() {
          p.fill(255);
          p.stroke(0);
          p.ellipse(this.pos.x, this.pos.y, this.radius * 2);
        }
      }

      function launchBall() {
        if (launched) return;

        launched = true;
        launchButton.disabled = true;

        // Calculate initial velocity components
        const angleRad = p.radians(angle);
        const vx = velocity * p.cos(angleRad) * scale;
        const vy = -velocity * p.sin(angleRad) * scale;

        // Create ball
        ball = new Ball(70, p.height - 100, vx, vy);

        // Initialize max height
        maxHeight = ball.pos.y;
        maxHeightDiv.textContent = `Max Height: ${((p.height - maxHeight) / scale).toFixed(2)} m`;
        resultDiv.textContent = '';
      }

      function resetSimulation() {
        launched = false;
        caught = false;
        hitGround = false;
        ball = null;
        launchButton.disabled = false;
        resultDiv.textContent = '';
        maxHeightDiv.textContent = '';
      }

      function checkCollisions(catcherX, catcherHeadY, catcherBodyY, catcherBodyHeight, catcherLegHeight) {
        if (!ball) return;

        // Check for catch
        const distanceToHead = p.dist(ball.pos.x, ball.pos.y, catcherX, catcherHeadY);
        const distanceToBody = p.dist(ball.pos.x, ball.pos.y, catcherX, catcherBodyY + catcherBodyHeight / 2);
        const distanceToLegs = p.dist(ball.pos.x, ball.pos.y, catcherX, catcherBodyY + catcherBodyHeight + catcherLegHeight / 2);

        if (distanceToHead < ball.radius + 10 ||
            distanceToBody < ball.radius + 20 ||
            distanceToLegs < ball.radius + 15) {
          caught = true;
          resultDiv.textContent = 'CAUGHT!';
          return;
        }

        // Check for ground hit
        if (ball.pos.y > p.height - 50) {
          hitGround = true;
          resultDiv.textContent = 'Hit the ground';
          return;
        }
      }

      function updateVelocity() {
        velocity = parseFloat(velocitySlider.value);
        document.getElementById('velocity-value').textContent = velocity;
      }

      function updateAngle() {
        angle = parseFloat(angleSlider.value);
        document.getElementById('angle-value').textContent = angle;
      }

      function updateWind() {
        windSpeed = parseFloat(windSlider.value);
        document.getElementById('wind-value').textContent = windSpeed;
      }

      function updateCatcherHeight() {
        catcherY = parseFloat(catcherHeightSlider.value);
        document.getElementById('catcher-height-value').textContent = catcherY;
      }
    };

    new p5(sketch);
  </script>
</body>
</html>